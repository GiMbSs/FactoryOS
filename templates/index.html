{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4">
    <h2 class="fw-bold mb-4 text-center">Bem-vindo ao Sistema de Gestão</h2>
    <div class="row g-4 mb-4 justify-content-center align-items-stretch">
        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow h-100 border-primary">
                <div class="card-body text-center">
                    <i class="bi bi-gear display-5 text-primary mb-2"></i>
                    <h5 class="card-title">Produção</h5>
                    <p class="mb-1"><span class="badge bg-primary fs-6">{{ ordens_andamento|length }}</span> Ordens em andamento</p>
                    <a href="{% url 'producao:lista_ordens' %}" class="btn btn-outline-primary btn-sm mt-2">Ver Produção</a>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow h-100 border-success">
                <div class="card-body text-center">
                    <i class="bi bi-cash-coin display-5 text-success mb-2"></i>
                    <h5 class="card-title">Financeiro</h5>
{% if vendas_nao_finalizadas %}
    <div class="alert alert-danger p-2 mb-2">
        <strong>Atenção!</strong><br>
        Vendas não finalizadas: <span class="fw-bold">{{ vendas_nao_finalizadas|length }}</span>
    </div>
{% endif %}
{% if contas_pagar_vencidas or contas_receber_vencidas %}
    <div class="alert alert-warning p-2 mb-2">
        <strong>Contas vencidas:</strong><br>
        {% if contas_pagar_vencidas %}
            Contas a pagar vencidas: <span class="fw-bold">{{ contas_pagar_vencidas|length }}</span><br>
        {% endif %}
        {% if contas_receber_vencidas %}
            Contas a receber vencidas: <span class="fw-bold">{{ contas_receber_vencidas|length }}</span>
        {% endif %}
    </div>
{% endif %}
<div class="mb-2">
    <span class="badge bg-secondary ms-1">{{ vendas_count }}</span>
</div>
<div class="mb-2">
    <span class="badge bg-success ms-1">{{ vendas_finalizadas_count }}</span>
</div>
<a href="{% url 'financeiro:dashboard' %}" class="btn btn-outline-success btn-sm mt-2">Ver Financeiro</a>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow h-100 border-warning">
                <div class="card-body text-center">
                    <i class="bi bi-exclamation-triangle display-5 text-warning mb-2"></i>
                    <h5 class="card-title">Estoque</h5>
                    <p class="mb-1"><span class="badge bg-warning text-dark fs-6">{{ alertas_estoque|length }}</span> Alertas de estoque</p>
                    <a href="{% url 'estoque:estoque_list' %}" class="btn btn-outline-warning btn-sm mt-2">Ver Estoque</a>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow h-100 border-info">
                <div class="card-body text-center">
                    <i class="bi bi-people display-5 text-info mb-2"></i>
                    <h5 class="card-title">Comercial</h5>
                    <a href="{% url 'comercial:lista_clientes' %}" class="btn btn-outline-info btn-sm mt-2">Ver Comercial</a>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-12 col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Produção Mensal</h5>
                </div>
                <div class="card-body">
                    <canvas id="producaoChart" height="200"></canvas>
                    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                    <script id="meses" type="application/json">{{ meses|safe }}</script>
                    <script id="quantidades" type="application/json">{{ quantidades|safe }}</script>
                    <script>
                        const meses = JSON.parse(document.getElementById('meses').textContent);
                        const quantidades = JSON.parse(document.getElementById('quantidades').textContent);
                        const ctx = document.getElementById('producaoChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: meses,
                                datasets: [{
                                    label: 'Ordens Finalizadas',
                                    data: quantidades,
                                    backgroundColor: '#0d6efd',
                                    borderColor: '#0d6efd',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: { display: false }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: { stepSize: 1 }
                                    }
                                }
                            }
                        });
                    </script>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-4">
            <div class="card shadow h-100 border-warning">
                <div class="card-header bg-warning">
                    <h5 class="mb-0">Alertas de Estoque</h5>
                </div>
                <div class="card-body">
                    {% if alertas_estoque %}
                    <ul class="list-group">
                        {% for alerta in alertas_estoque %}
                        <li class="list-group-item">
                            {{ alerta.materia_prima }} - 
                            {{ alerta.quantidade_atual }} {{ alerta.unidade_medida }}
                            (mín: {{ alerta.estoque_minimo }})
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <div class="alert alert-success">Nenhum alerta de estoque</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

{% endblock %}
